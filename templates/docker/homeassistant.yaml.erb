version: '3'
services:
  home-assistant:
    image: 'homeassistant/home-assistant'
    volumes:
      - '/media/tb-tb/homeassistant:/config'
      - '/etc/localtime:/etc/localtime:ro'
    devices:
      - '/dev/ttyACM0:/dev/ttyACM0'
    labels:
      - "traefik.frontend.rule=Host:ha.cascadia.demophoon.com"
      - "traefik.docker.network=traefikdocker_default"
      - "traefik.enable=true"
      - "traefik.port=8123"
      - "traefik.backend=internal_https"
    networks:
      - web
      - backend
    privileged: true

  mosquitto:
    image: 'eclipse-mosquitto'
    volumes:
      - '/media/tb-tb/mosquitto:/mosquitto/config'
    ports:
      - '1883:1883'
      - '9001:9001'
    networks:
      - backend

networks:
  web:
    external:
      name: 'traefikdocker_default'
  backend:
